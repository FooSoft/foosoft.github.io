<!doctype html><html lang=en><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet href=/lib/bootstrap/css/bootstrap.min.css><link rel=stylesheet href=/lib/tether/css/tether.min.css><link rel=stylesheet href=/lib/tether/css/tether-theme-basic.min.css><link rel=stylesheet href=/lib/lightbox/ekko-lightbox.css><link rel=stylesheet href=/main.css><title>FooSoft Productions - Moonfall</title><nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top"><a class=navbar-brand href=/><img src=/img/foosoft.png alt=FooSoft class=d-inline-block id=brand>
FooSoft Productions</a>
<button class=navbar-toggler type=button data-toggle=collapse data-target=#navbarNavAltMarkup>
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarNavAltMarkup><div class="navbar-nav ml-auto"><a class="nav-item nav-link" href=/>Overview</a>
<a class="nav-item nav-link" href=/posts/>Posts</a>
<a class="nav-item nav-link" href=/portfolio/>Portfolio</a>
<a class="nav-item nav-link active" href=/projects/>Projects</a>
<a class="nav-item nav-link" href=/tags/>Tags</a></div></div></nav><div><a href=https://github.com/FooSoft/moonfall class=github-corner><svg width="80" height="80" viewBox="0 0 250 250">
            <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
            <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
            <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path>
        </svg></a></div><div class=container><h1>Moonfall</h1><div><a class="badge badge-secondary" href=/tags/cpp/index.html>cpp</a>
<a class="badge badge-secondary" href=/tags/games/index.html>games</a>
<a class="badge badge-secondary" href=/tags/gpl-license/index.html>gpl license</a>
<a class="badge badge-secondary" href=/tags/lua/index.html>lua</a>
<a class="badge badge-secondary" href=/tags/moonfall/index.html>moonfall</a>
<a class="badge badge-secondary" href=/tags/sdl/index.html>sdl</a>
<a class="badge badge-secondary" href=/tags/tinyxml/index.html>tinyxml</a>
<a class="badge badge-secondary" href=/tags/wxwidgets/index.html>wxwidgets</a></div><hr><p>Moonfall is the name of a game engine that I spent several months developing back in 2008. It leveraged SDL for
graphics, Lua for in-game scripting, and wxWidgets for the built-in developer tools. The cross-platform engine was
written using the Code::Blocks IDE, but Visual Studio project files are also available.<p>The game was partially inspired by <a href=http://en.wikipedia.org/wiki/Harvest_Moon_%28video_game%29>Harvest Moon</a> for the
Super Nintendo and <a href=http://en.wikipedia.org/wiki/Higurashi_When_They_Cry>When They Cry</a> by <a href=http://en.wikipedia.org/wiki/07th_Expansion>07th
Expansion</a>. The protagonist is a city dweller, who upon inheriting a small
farm from a distant relative, decides to try his hand in agriculture. He finds the residents of the nearby small town a
friendly bunch, but something about them does not seem right. Everyone is appears to be hiding something from the
player, who must uncover the truth to survive. In short, this is (as I have described it to my friends), “Harvest Moon
with Murder.”<p><a href=/projects/moonfall/img/gameplay.png class="img-thumbnail img-thumbnail-inline" data-title="Gameplay window" data-toggle=lightbox data-gallery=gallery><img src=/projects/moonfall/img/gameplay-thumb.png alt="Gameplay window"></a>
<a href=/projects/moonfall/img/sprite-editor.png class="img-thumbnail img-thumbnail-inline" data-title="Sprite editor" data-toggle=lightbox data-gallery=gallery><img src=/projects/moonfall/img/sprite-editor-thumb.png alt="Sprite editor"></a>
<a href=/projects/moonfall/img/console.png class="img-thumbnail img-thumbnail-inline" data-title="Console window" data-toggle=lightbox data-gallery=gallery><img src=/projects/moonfall/img/console-thumb.png alt="Console window"></a>
<a href=/projects/moonfall/img/asset-editor.png class="img-thumbnail img-thumbnail-inline" data-title="Asset editor" data-toggle=lightbox data-gallery=gallery><img src=/projects/moonfall/img/asset-editor-thumb.png alt="Asset editor"></a>
<a href=/projects/moonfall/img/map-editor.png class="img-thumbnail img-thumbnail-inline" data-title="Map editor" data-toggle=lightbox data-gallery=gallery><img src=/projects/moonfall/img/map-editor-thumb.png alt="Map editor"></a><h2 id=technology>Technology</h2><p>From a technical point of view, the game engine was an exercise in creating a completely data driven game. In
retrospect, it was probably over-engineered, but in general it was flexible and I liked what I could do with it. At the
core of the engine was the <code>Actor</code> class, the functionality of which could be expanded through add-on properties. The
property definitions were specified in XML; for example, below is the definition for the playable character:<pre style=background-color:#fff><span style=color:#000080>&lt;Actor</span> <span style=color:#008080>alias =</span> <span style=color:#d14>&#34;Player.01&#34;</span> <span style=color:#008080>dynamic =</span> <span style=color:#d14>&#34;1&#34;</span> <span style=color:#008080>layer =</span> <span style=color:#d14>&#34;4&#34;</span> <span style=color:#008080>thumbnail =</span> <span style=color:#d14>&#34;Player.01.Idle.S.01&#34;</span><span style=color:#000080>&gt;</span>
    <span style=color:#000080>&lt;Properties&gt;</span>
        <span style=color:#000080>&lt;Animation</span> <span style=color:#000080>/&gt;</span>
        <span style=color:#000080>&lt;Script</span> <span style=color:#008080>resource =</span> <span style=color:#d14>&#34;Player.01.Default&#34;</span> <span style=color:#000080>/&gt;</span>
        <span style=color:#000080>&lt;Physics</span> <span style=color:#000080>/&gt;</span>
    <span style=color:#000080>&lt;/Properties&gt;</span>
<span style=color:#000080>&lt;/Actor&gt;</span>
</pre><p>In addition to the self-explainable <code>Animation</code> and <code>Physics</code> properties, you can see a <code>Script</code> node which associates a
Lua script with the actor. Scripts would get notifications about events such as <code>OnActorUpdate</code>, during which custom
processing could take place:<pre style=background-color:#fff><span style=color:#000;font-weight:bold>function</span> <span style=color:#900;font-weight:bold>OnActorUpdate</span>(elapsed)
    <span style=color:#000;font-weight:bold>if</span> InputIsKeyTriggered(META_KEY_USE) <span style=color:#000;font-weight:bold>then</span>
        DoActorUse()
        <span style=color:#000;font-weight:bold>return</span>
    <span style=color:#000;font-weight:bold>elseif</span> InputIsKeyPressed(META_KEY_UP) <span style=color:#000;font-weight:bold>then</span>
        DoActorWalk(DIRECTION_NORTH)
        <span style=color:#000;font-weight:bold>return</span>
    <span style=color:#000;font-weight:bold>elseif</span> InputIsKeyPressed(META_KEY_DOWN) <span style=color:#000;font-weight:bold>then</span>
        DoActorWalk(DIRECTION_SOUTH)
        <span style=color:#000;font-weight:bold>return</span>
    <span style=color:#000;font-weight:bold>elseif</span> InputIsKeyPressed(META_KEY_LEFT) <span style=color:#000;font-weight:bold>then</span>
        DoActorWalk(DIRECTION_WEST)
        <span style=color:#000;font-weight:bold>return</span>
    <span style=color:#000;font-weight:bold>elseif</span> InputIsKeyPressed(META_KEY_RIGHT) <span style=color:#000;font-weight:bold>then</span>
        DoActorWalk(DIRECTION_EAST)
        <span style=color:#000;font-weight:bold>return</span>
    <span style=color:#000;font-weight:bold>end</span>

    DoActorIdle(playerDirection)
<span style=color:#000;font-weight:bold>end</span>
</pre><p>Scripts can directly interact with properties on the parent <code>Actor</code> and can communicate with surrounding world via a
messaging system. This made it possible to build any game object imaginable by editing a couple of XML files and some
simple scripting.<pre style=background-color:#fff><span style=color:#000;font-weight:bold>function</span> <span style=color:#900;font-weight:bold>DoActorWalk</span>(direction)
    <span style=color:#000;font-weight:bold>if</span> playerAction <span style=color:#000;font-weight:bold>==</span> ACTION_WALK <span style=color:#000;font-weight:bold>and</span> playerDirection <span style=color:#000;font-weight:bold>==</span> direction <span style=color:#000;font-weight:bold>then</span>
        <span style=color:#000;font-weight:bold>return</span>
    <span style=color:#000;font-weight:bold>end</span>

    ActorPhysicsSetVelocity(playerId, playerWalkVelocities[direction])
    ActorAnimationSet(playerId, playerWalkAnimations[direction])
    ActorAnimationPlay(playerId, <span style=color:#000;font-weight:bold>true</span>)

    playerDirection <span style=color:#000;font-weight:bold>=</span> direction
    playerAction <span style=color:#000;font-weight:bold>=</span> ACTION_WALK
<span style=color:#000;font-weight:bold>end</span>

<span style=color:#000;font-weight:bold>function</span> <span style=color:#900;font-weight:bold>DoActorUse</span>()
    actorsIds <span style=color:#000;font-weight:bold>=</span> ActorPhysicsQueryShapeCollisions(
        playerId,
        ACTOR_SHAPE_TYPE_COLLISION_INTERACT
    )

    <span style=color:#000;font-weight:bold>for</span> i, v <span style=color:#000;font-weight:bold>in</span> ipairs(actorsIds) <span style=color:#000;font-weight:bold>do</span>
        ActorScriptSendMessage(v, <span style=color:#d14>&#34;interact&#34;</span>, { user <span style=color:#000;font-weight:bold>=</span> playerId })
    <span style=color:#000;font-weight:bold>end</span>
<span style=color:#000;font-weight:bold>end</span>

</pre><p>I eventually stopped work on Moonfall due to a lack of time, combined with the fact that I am not an artist and could
not author the assets required to develop this into a complete game.<div><nav class=breadcrumb><a href=/projects/index.html class=breadcrumb-item>Projects</a>
<span class="breadcrumb-item active">Moonfall</span></nav></div></div><script src=/lib/jquery.min.js></script><script src=/lib/tether/js/tether.min.js></script><script src=/lib/bootstrap/js/bootstrap.min.js></script><script src=/lib/lightbox/ekko-lightbox.min.js></script><script src=/main.js></script><script>var clicky_site_ids = clicky_site_ids || []; clicky_site_ids.push(101024911);</script><script async src=//static.getclicky.com/js></script>